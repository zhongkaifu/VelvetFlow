{
  "workflow_name": "员工体温健康预警工作流",
  "description": "每天早上循环检查每位员工的体温，体温超过38度的员工加入健康预警列表，最后生成健康预警报告或普通健康报告。",
  "nodes": [
    {
      "id": "fetch_temperatures",
      "type": "action",
      "action_id": "hr.get_today_temperatures.v1",
      "display_name": "获取当天所有员工体温数据",
      "params": {
        "date": "${current_date}"
      },
      "out_params_schema": {
        "type": "object",
        "properties": {
          "date": {
            "type": "string"
          },
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "employee_id": {
                  "type": "string"
                },
                "temperature": {
                  "type": "number"
                }
              },
              "required": [
                "employee_id",
                "temperature"
              ]
            }
          }
        },
        "required": [
          "date",
          "data"
        ]
      }
    },
    {
      "id": "loop_check_temperature",
      "type": "loop",
      "action_id": null,
      "display_name": "循环检查每位员工体温",
      "params": {
        "source": "result_of.fetch_temperatures.data",
        "exports": {
          "items": {
            "from_node": "add_to_warning_list",
            "fields": [
              "employee_id",
              "last_temperature",
              "status"
            ],
            "mode": "collect"
          }
        },
        "body_subgraph": {
          "nodes": [
            {
              "id": "check_temperature_high",
              "type": "condition",
              "display_name": "判断体温是否超过38度",
              "params": {
                "source": "employee_temp",
                "field": "temperature",
                "threshold": 38,
                "kind": "greater_than"
              },
              "true_to_node": "add_to_warning_list",
              "false_to_node": null,
              "parent_node_id": "loop_check_temperature"
            },
            {
              "id": "add_to_warning_list",
              "type": "action",
              "action_id": "hr.update_employee_health_profile.v1",
              "display_name": "将体温超标员工加入健康预警列表",
              "params": {
                "employee_id": "${employee_temp.employee_id}",
                "last_check_date": "${current_date}",
                "last_temperature": "${employee_temp.temperature}",
                "status": "warning"
              },
              "out_params_schema": {
                "type": "object",
                "properties": {
                  "employee_id": {
                    "type": "string"
                  },
                  "last_temperature": {
                    "type": "number"
                  },
                  "status": {
                    "type": "string"
                  }
                },
                "required": [
                  "employee_id",
                  "last_temperature"
                ]
              },
              "parent_node_id": "loop_check_temperature"
            }
          ],
          "entry": "check_temperature_high",
          "exit": "add_to_warning_list"
        },
        "loop_kind": "for_each",
        "item_alias": "employee_temp"
      }
    },
    {
      "id": "check_warning_list_empty",
      "type": "condition",
      "action_id": null,
      "display_name": "判断健康预警列表是否为空",
      "params": {
        "source": "result_of.loop_check_temperature.exports.items",
        "kind": "list_not_empty"
      },
      "true_to_node": "generate_warning_report",
      "false_to_node": "generate_normal_report"
    },
    {
      "id": "generate_warning_report",
      "type": "action",
      "action_id": "hr.update_employee_health_profile.v1",
      "display_name": "生成健康预警报告",
      "params": {
        "employee_id": "health_warning",
        "last_temperature": 0
      },
      "out_params_schema": {
        "type": "object",
        "properties": {
          "employee_id": {
            "type": "string"
          },
          "last_temperature": {
            "type": "number"
          },
          "status": {
            "type": "string"
          }
        },
        "required": [
          "employee_id",
          "last_temperature"
        ]
      }
    },
    {
      "id": "generate_normal_report",
      "type": "action",
      "action_id": "hr.update_employee_health_profile.v1",
      "display_name": "生成普通健康报告",
      "params": {
        "employee_id": "normal",
        "last_temperature": 0
      },
      "out_params_schema": {
        "type": "object",
        "properties": {
          "employee_id": {
            "type": "string"
          },
          "last_temperature": {
            "type": "number"
          },
          "status": {
            "type": "string"
          }
        },
        "required": [
          "employee_id",
          "last_temperature"
        ]
      }
    },
    {
      "id": "daily_trigger",
      "type": "action",
      "action_id": "hr.record_health_event.v1",
      "display_name": "每天早上定时触发工作流",
      "params": {
        "event_type": "daily_health_check"
      },
      "out_params_schema": {
        "type": "object",
        "properties": {
          "status": {
            "type": "string"
          },
          "event_id": {
            "type": "string"
          }
        }
      }
    }
  ]
}