<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VelvetFlow Workflow Studio</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header class="app__header">
      <div class="title-block">
        <img src="/logo.jpg" alt="VelvetFlow logo" class="logo" />
        <div>
          <div class="eyebrow">VelvetFlow Agent Playground</div>
          <h1>Visual Workflow Builder</h1>
          <p class="subtitle">Describe your needs in natural language to automatically build, modify, and run a visual DAG.</p>
        </div>
      </div>
    </header>

    <main class="layout">
      <section class="canvas-panel">
        <div class="tab-bar" role="tablist">
          <button class="tab" data-tab="json" role="tab" aria-selected="false">Workflow JSON</button>
          <button class="tab tab--active" data-tab="visual" role="tab" aria-selected="true">Flowchart View</button>
        </div>
        <div class="tab-content tab-content--hidden" data-view="json">
          <div class="editor">
            <div class="editor__header">
              <h3>Workflow JSON</h3>
              <div class="editor__actions">
                <input id="loadWorkflowFile" type="file" accept="application/json" class="visually-hidden" />
                <button id="loadWorkflow" class="button button--ghost">Load from File</button>
                <button id="saveWorkflow" class="button button--ghost">Save to File</button>
                <button id="resetWorkflow" class="button button--ghost">Reset</button>
                <button id="applyWorkflow" class="button">Apply Changes</button>
              </div>
            </div>
            <p class="muted">You can edit the DAG directly and VelvetFlow will re-render the canvas.</p>
            <textarea id="workflowEditor" spellcheck="false" aria-label="workflow json"></textarea>
          </div>
        </div>
        <div class="tab-content" data-view="visual">
          <div class="canvas-wrapper">
            <div class="canvas-toolbar">
              <div class="canvas-toolbar__group">
                <button type="button" class="icon-button" id="zoomOut" aria-label="Zoom out">−</button>
                <span class="canvas-toolbar__label" id="zoomValue">100%</span>
                <button type="button" class="icon-button" id="zoomIn" aria-label="Zoom in">＋</button>
              </div>
              <button type="button" class="button button--ghost" id="resetView">Reset View</button>
            </div>
            <div id="canvasHost">
              <canvas id="workflowCanvas" width="1080" height="620" aria-label="workflow canvas"></canvas>
              <p class="muted tab-hint">Hint: Right-click on blank canvas space to add nodes. Double-click nodes to edit parameters or jump into loop subgraphs; you can delete nodes in the edit dialog.</p>
            </div>
            <div id="addNodeMenu" class="context-menu hidden" role="dialog" aria-modal="true" aria-label="Add node">
              <div class="context-menu__header">
                <h4>Add a New Node</h4>
                <button type="button" class="context-menu__close" aria-label="Close" id="closeAddNodeMenu">×</button>
              </div>
              <label class="context-menu__field">
                <span>Node type</span>
                <select id="addNodeType" class="context-menu__input">
                  <option value="action" selected>Action</option>
                  <option value="condition">Condition</option>
                  <option value="loop">Loop</option>
                </select>
              </label>
              <label class="context-menu__field">
                <span>Display name (optional)</span>
                <input id="addNodeName" class="context-menu__input" placeholder="Example: Approval step" />
              </label>
              <label class="context-menu__field" id="addNodeActionRow">
                <span>Business tool (action_id)</span>
                <select id="addNodeActionSelect" class="context-menu__input" aria-label="Select business tool"></select>
              </label>
              <div class="context-menu__actions">
                <button type="button" class="button button--ghost" id="cancelAddNode">Cancel</button>
                <button type="button" class="button button--primary" id="confirmAddNode">Add node</button>
              </div>
              <p class="muted context-menu__hint">Hint: Nodes are auto-laid out; drag a node to reposition it.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="chat-panel">
        <div class="panel__header">
          <div>
            <h2>VelvetFlow Agent Console</h2>
            <p class="muted">Enter your requirements in natural language to build or iterate on a workflow. Progress is shown in real time.</p>
          </div>
          <div class="status" id="statusIndicator">Waiting for input</div>
        </div>
        <div class="chat-log" id="chatLog" aria-live="polite"></div>
        <form id="chatForm" class="chat-input" autocomplete="off">
          <label class="visually-hidden" for="userInput">Requirement input</label>
          <textarea id="userInput" placeholder="Example: Build an onboarding workflow covering account requests, device assignment, and approvals" required></textarea>
          <div class="chat-actions">
            <button type="button" id="editHelp" class="button button--ghost" title="How to edit an existing workflow">Edit guidance</button>
            <div class="chat-actions__group">
              <button type="submit" class="button button--primary">Build workflow</button>
              <button type="button" id="runWorkflow" class="button button--primary">Run workflow</button>
            </div>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script src="js/core.js"></script>
  <script src="js/dialogs.js"></script>
  <script src="js/canvas.js"></script>
  <script src="js/network.js"></script>
  <script src="js/interactions.js"></script>
</body>
</html>
